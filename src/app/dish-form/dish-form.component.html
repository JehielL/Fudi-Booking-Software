@if (showSpinner) {
  <section class="dots-container">
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
  </section>
}@else {
  <div class="dish-page">
    <!-- Header estilo booking -->
    <header class="dish-header smoke-hero">
      <div class="header-overlay"></div>
      <div class="header-content">
        <div class="dish-badge">
          <i class="bi bi-egg-fried"></i>
        </div>
        <h1 class="dish-title">{{ isUpdate ? 'Editar plato' : 'Crear plato' }}</h1>
        @if (menu) {
          <p class="dish-subtitle">
            <i class="bi bi-journal-richtext"></i> Men√∫: {{ menu.title }}
          </p>
        }
      </div>
    </header>

    @if (menu) {
      <!-- Resumen flotante estilo booking -->
      <div class="dish-summary-card">
        <div class="summary-header">
          <i class="bi bi-receipt"></i>
          <span>Resumen del plato</span>
        </div>
        <div class="summary-grid">
          <div class="summary-item">
            <i class="bi bi-type"></i>
            <div class="summary-text">
              <span class="label">T√≠tulo</span>
              <span class="value">{{ dishForm.get('title')?.value || 'Sin t√≠tulo' }}</span>
            </div>
          </div>
          <div class="summary-item">
            <i class="bi bi-cash"></i>
            <div class="summary-text">
              <span class="label">Precio</span>
              <span class="value">‚Ç¨{{ dishForm.get('price')?.value || '0.00' }}</span>
            </div>
          </div>
          <div class="summary-item">
            <i class="bi bi-eye"></i>
            <div class="summary-text">
              <span class="label">Visibilidad</span>
              <span class="value">{{ dishForm.get('active')?.value ? 'Activo' : 'Oculto' }}</span>
            </div>
          </div>
          <div class="summary-item">
            <i class="bi bi-shield-check"></i>
            <div class="summary-text">
              <span class="label">Al√©rgenos</span>
              <span class="value">{{ dishForm.get('alergys')?.value ? 'Marcados' : 'Sin marcar' }}</span>
            </div>
          </div>
          <div class="summary-item">
            <i class="bi bi-journal"></i>
            <div class="summary-text">
              <span class="label">Men√∫</span>
              <span class="value">{{ menu.title }}</span>
            </div>
          </div>
        </div>
      </div>

      <main class="dish-main">
        <div class="dish-layout">
          <!-- Formulario principal -->
          <form class="dish-form" [formGroup]="dishForm" (ngSubmit)="save()">
            <input type="hidden" formControlName="id">

            <!-- Paso 1: Datos b√°sicos -->
            <section class="form-section">
              <div class="section-header">
                <span class="step-number">1</span>
                <h3>Datos b√°sicos</h3>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="title"><i class="bi bi-type"></i> T√≠tulo del plato</label>
                  <input id="title" type="text" formControlName="title" placeholder="Ej. Taco de birria crujiente" class="modern-input">
                </div>
                <div class="form-group">
                  <label for="price"><i class="bi bi-cash-stack"></i> Precio</label>
                  <div class="input-prefix">
                    <span>‚Ç¨</span>
                    <input id="price" type="number" step="0.01" formControlName="price" placeholder="12.50" class="modern-input">
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group full-width">
                  <label for="menu"><i class="bi bi-journal-richtext"></i> Men√∫ asociado</label>
                  <select id="menu" class="modern-input" formControlName="menu" [compareWith]="compareObjects">
                    <option [ngValue]="menu">{{ menu.title }}</option>
                  </select>
                </div>
              </div>
            </section>

            <!-- Paso 2: Descripci√≥n -->
            <section class="form-section">
              <div class="section-header">
                <span class="step-number">2</span>
                <h3>Descripci√≥n</h3>
              </div>
              <div class="form-group">
                <label for="description"><i class="bi bi-chat-text"></i> Describe tu plato</label>
                <textarea id="description" rows="4" formControlName="description" placeholder="Historia, ingredientes clave y textura" class="modern-input"></textarea>
              </div>
            </section>

            <!-- Paso 3: Visibilidad y al√©rgenos -->
            <section class="form-section">
              <div class="section-header">
                <span class="step-number">3</span>
                <h3>Visibilidad y al√©rgenos</h3>
              </div>
              <div class="toggle-row">
                <label class="toggle-card">
                  <input type="checkbox" formControlName="active">
                  <span class="toggle-thumb"></span>
                  <div class="toggle-text">
                    <span class="title">Mostrar en carta</span>
                    <span class="subtitle">Hazlo visible para clientes</span>
                  </div>
                </label>
                <label class="toggle-card">
                  <input type="checkbox" formControlName="alergys">
                  <span class="toggle-thumb"></span>
                  <div class="toggle-text">
                    <span class="title">Marcar al√©rgenos</span>
                    <span class="subtitle">Indica presencia de al√©rgenos</span>
                  </div>
                </label>
              </div>
            </section>

            <!-- Paso 4: Foto -->
            <section class="form-section">
              <div class="section-header">
                <span class="step-number">4</span>
                <h3>Foto del plato</h3>
              </div>
              <div class="upload" (click)="photoInput.click()">
                <div class="upload__preview" [class.has-image]="photoPreview || dish?.imgDish">
                  @if (photoPreview || dish?.imgDish) {
                    <img [src]="photoPreview || ('http://localhost:8080/files/' + dish?.imgDish)" alt="preview">
                  } @else {
                    <div class="upload__placeholder">
                      <div class="icon">üì∑</div>
                      <p>Sube una foto o arrastra aqu√≠</p>
                      <small>JPG o PNG, m√°x 5MB</small>
                    </div>
                  }
                </div>
                <input #photoInput type="file" accept="image/*" (change)="onFileChange($event)" hidden>
                <button type="button" class="ghost-btn" aria-label="Seleccionar foto">Cambiar foto</button>
              </div>
            </section>

            <div class="submit-section sticky-actions">
              <button type="button" class="ghost-btn" (click)="navigateToList()">
                <i class="bi bi-arrow-left"></i> Volver
              </button>
              <button class="submit-btn" type="submit">
                <i class="bi" [class.bi-check2-circle]="!isUpdate" [class.bi-pencil-square]="isUpdate"></i>
                <span>{{ isUpdate ? 'Actualizar plato' : 'Crear plato' }}</span>
              </button>
            </div>
          </form>

          <!-- Vista previa -->
          <section class="preview-card">
            <div class="preview-media">
              @if (photoPreview || dish?.imgDish) {
                <img [src]="photoPreview || ('http://localhost:8080/files/' + dish?.imgDish)" alt="preview">
              } @else {
                <div class="placeholder">
                  <p>Previsualiza aqu√≠ tu foto</p>
                </div>
              }
              <div class="badge">Live preview</div>
              <div class="status-badge" [class.active]="dishForm.get('active')?.value">
                {{ dishForm.get('active')?.value ? 'Publicado' : 'Oculto' }}
              </div>
            </div>
            <div class="preview-body">
              <div class="preview-header">
                <h3>{{ dishForm.get('title')?.value || 'T√≠tulo del plato' }}</h3>
                <span class="price">‚Ç¨{{ dishForm.get('price')?.value || '0.00' }}</span>
              </div>
              <p class="preview-desc">{{ dishForm.get('description')?.value || 'Describe tu plato para que sea irresistible.' }}</p>
              <div class="preview-tags">
                <span class="tag" [class.on]="dishForm.get('active')?.value">{{ dishForm.get('active')?.value ? 'Publicado' : 'Oculto' }}</span>
                <span class="tag" [class.on]="dishForm.get('alergys')?.value">{{ dishForm.get('alergys')?.value ? 'Al√©rgenos marcados' : 'Sin marcar' }}</span>
              </div>
            </div>
          </section>
        </div>
      </main>
    }
  </div>
}
