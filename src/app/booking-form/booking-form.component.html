@if (showSpinner) {
  <section class="dots-container">
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
  </section>
} @else {

<div class="booking-page">
  <!-- Header con imagen del restaurante -->
  <header class="booking-header smoke-hero">
    <div class="header-overlay"></div>
    <div class="header-content">
      <div class="restaurant-badge">
        <i class="bi bi-shop"></i>
      </div>
      <h1 class="restaurant-name">{{ restaurant?.name || 'Reservar Mesa' }}</h1>
      @if (restaurant?.address) {
        <p class="restaurant-location">
          <i class="bi bi-geo-alt"></i> {{ restaurant?.address }}
        </p>
      }
    </div>
  </header>

  <!-- Resumen de reserva flotante -->
  <div class="booking-summary-card">
    <div class="summary-header">
      <i class="bi bi-bookmark-check"></i>
      <span>Resumen de tu reserva</span>
    </div>
    <div class="summary-grid">
      <div class="summary-item">
        <i class="bi bi-person-circle"></i>
        <div class="summary-text">
          <span class="label">A nombre de</span>
          <span class="value">{{ user?.firstName }} {{ user?.lastName }}</span>
        </div>
      </div>
      <div class="summary-item">
        <i class="bi bi-calendar-event"></i>
        <div class="summary-text">
          <span class="label">Fecha</span>
          <span class="value">{{ formatDateDisplay(bookingForm.get('bookingDate')?.value) }}</span>
        </div>
      </div>
      <div class="summary-item">
        <i class="bi bi-clock"></i>
        <div class="summary-text">
          <span class="label">Hora</span>
          <span class="value">{{ bookingForm.get('bookingTime')?.value || '--:--' }}</span>
        </div>
      </div>
      <div class="summary-item">
        <i class="bi bi-people"></i>
        <div class="summary-text">
          <span class="label">Personas</span>
          <span class="value">{{ bookingForm.get('numPeople')?.value }} personas</span>
        </div>
      </div>
      <div class="summary-item">
        <i class="bi bi-pin-map"></i>
        <div class="summary-text">
          <span class="label">Ubicación</span>
          <span class="value">{{ bookingForm.get('interior')?.value ? 'Interior' : 'Terraza' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Formulario principal -->
  <main class="booking-main">
    <form [formGroup]="bookingForm" (ngSubmit)="save()" class="booking-form">
      <input type="hidden" formControlName="id">

      <!-- Paso 1: Fecha y personas -->
      <section class="form-section">
        <div class="section-header">
          <span class="step-number">1</span>
          <h3>¿Cuándo y cuántos?</h3>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="bookingDate">
              <i class="bi bi-calendar3"></i> Fecha
            </label>
            <input 
              type="date" 
              id="bookingDate" 
              formControlName="bookingDate" 
              required
              (change)="onDateChange()"
              class="modern-input">
          </div>
          <div class="form-group">
            <label for="numPeople">
              <i class="bi bi-people-fill"></i> Personas
            </label>
            <div class="people-selector">
              <button type="button" class="people-btn" (click)="decrementPeople()">
                <i class="bi bi-dash"></i>
              </button>
              <input 
                type="number" 
                id="numPeople" 
                formControlName="numPeople" 
                min="1" 
                max="20"
                class="people-input"
                readonly>
              <button type="button" class="people-btn" (click)="incrementPeople()">
                <i class="bi bi-plus"></i>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Paso 2: Horario -->
      <section class="form-section">
        <div class="section-header">
          <span class="step-number">2</span>
          <h3>Elige tu horario</h3>
        </div>
        
        @if (showTimeSlotPicker && restaurant?.id && bookingForm.get('bookingDate')?.value) {
          <app-time-slot-picker
            [restaurantId]="restaurant!.id"
            [date]="bookingForm.get('bookingDate')!.value!"
            [numPeople]="bookingForm.get('numPeople')?.value || 2"
            (slotSelected)="onSlotSelected($event)">
          </app-time-slot-picker>
          
          @if (selectedSlot) {
            <div class="selected-slot-badge">
              <i class="bi bi-check-circle-fill"></i>
              <span>{{ selectedSlot.time }} - {{ selectedSlot.remainingCapacity }} plazas disponibles</span>
            </div>
          }
        } @else {
          <div class="form-group">
            <label for="bookingTime">
              <i class="bi bi-clock-fill"></i> Hora
            </label>
            <input 
              type="time" 
              id="bookingTime" 
              formControlName="bookingTime" 
              required
              class="modern-input">
          </div>
          <p class="hint-text">
            <i class="bi bi-info-circle"></i> 
            Selecciona primero una fecha para ver los horarios disponibles
          </p>
        }
      </section>

      <!-- Paso 3: Preferencias -->
      <section class="form-section">
        <div class="section-header">
          <span class="step-number">3</span>
          <h3>Preferencias</h3>
        </div>
        
        <!-- Selector Interior/Terraza -->
        <div class="location-toggle">
          <button 
            type="button" 
            class="location-btn" 
            [class.active]="bookingForm.get('interior')?.value"
            (click)="setInterior(true)">
            <i class="bi bi-house-door"></i>
            <span>Interior</span>
          </button>
          <button 
            type="button" 
            class="location-btn" 
            [class.active]="!bookingForm.get('interior')?.value"
            (click)="setInterior(false)">
            <i class="bi bi-sun"></i>
            <span>Terraza</span>
          </button>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="observations">
              <i class="bi bi-chat-text"></i> Observaciones
            </label>
            <input 
              type="text" 
              id="observations" 
              formControlName="observations" 
              placeholder="Ej: Celebración de cumpleaños, aniversario..."
              class="modern-input">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="specialRequests">
              <i class="bi bi-star"></i> Peticiones especiales
            </label>
            <input 
              type="text" 
              id="specialRequests" 
              formControlName="specialRequests" 
              placeholder="Ej: Mesa cerca de ventana, silla para bebé..."
              class="modern-input">
          </div>
        </div>
      </section>

      <!-- Paso 4: Contacto (opcional) -->
      <section class="form-section collapsible">
        <div class="section-header clickable" (click)="toggleContactSection()">
          <span class="step-number optional">+</span>
          <h3>Datos de contacto <span class="optional-badge">Opcional</span></h3>
          <i class="bi" [class.bi-chevron-down]="!showContactSection" [class.bi-chevron-up]="showContactSection"></i>
        </div>
        
        @if (showContactSection) {
          <div class="form-row animated">
            <div class="form-group">
              <label for="contactName">
                <i class="bi bi-person"></i> Nombre
              </label>
              <input 
                type="text" 
                id="contactName" 
                formControlName="contactName" 
                placeholder="Nombre de contacto"
                class="modern-input">
            </div>
            <div class="form-group">
              <label for="contactPhone">
                <i class="bi bi-telephone"></i> Teléfono
              </label>
              <input 
                type="tel" 
                id="contactPhone" 
                formControlName="contactPhone" 
                placeholder="+34 600 000 000"
                class="modern-input">
            </div>
          </div>
        }
      </section>

      <!-- Botón de envío -->
      <div class="submit-section">
        @if (isUpdate) {
          <button type="submit" class="submit-btn update">
            <i class="bi bi-pencil-square"></i>
            <span>Actualizar Reserva</span>
          </button>
        } @else {
          <button type="submit" class="submit-btn">
            <i class="bi bi-check2-circle"></i>
            <span>Confirmar Reserva</span>
          </button>
        }
      </div>
    </form>
  </main>
</div>

}