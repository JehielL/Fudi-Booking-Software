@if (showSpinner) {

  <section class="dots-container">
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
  </section>

}@else {

<!-- Hero Section del Restaurante -->
<div class="restaurant-hero-section">
  <div class="container">
    <div class="row g-4 align-items-start">

      <!-- Imagen del restaurante -->
      <div class="col-md-5">
        <div class="restaurant-image-wrapper">
          <img class="restaurant-image"
            [src]="restaurant?.imageUrl?.startsWith('http') ? restaurant?.imageUrl : ('https://api.fudi.es/files/' + restaurant?.imageUrl)"
            [alt]="restaurant?.name">
          <div class="image-overlay">
            <div class="rating-big">
              <i class="bi bi-star-fill"></i>
              <span>{{restaurant?.averageRating || 0}}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Información del restaurante -->
      <div class="col-md-7">
        <div class="restaurant-info-card">
          <div class="restaurant-header">
            <h1 class="restaurant-title">{{restaurant?.name}}</h1>
          </div>

          <div class="restaurant-details-grid">
            <!-- Tipo de cocina -->
            <div class="detail-item">
              <div class="detail-label">
                <i class="bi bi-shop"></i>
                Tipo de Cocina
              </div>
              <div class="detail-value">
                <span class="category-badge">{{getRestaurantType(restaurant?.restaurantType)}}</span>
              </div>
            </div>

            <!-- Teléfono -->
            <div class="detail-item">
              <div class="detail-label">
                <i class="bi bi-telephone-fill"></i>
                Teléfono
              </div>
              <div class="detail-value">{{restaurant?.phone}}</div>
            </div>

            <!-- Horario -->
            <div class="detail-item">
              <div class="detail-label">
                <i class="bi bi-clock"></i>
                Horario
              </div>
              <div class="detail-value">{{formatTime(restaurant?.openingTime)}} - {{formatTime(restaurant?.closingTime)}}</div>
            </div>
          </div>

          <!-- Descripción -->
          <div class="description-section">
            <div class="detail-label">
              <i class="bi bi-card-text"></i>
              Descripción
            </div>
            <p class="description-text">{{restaurant?.description}}</p>
          </div>

          <!-- Botones de acción -->
          <div class="restaurant-actions">
            <a [routerLink]="['/bookings', restaurant?.id, 'reserve']" class="action-btn primary-btn">
              <i class="bi bi-calendar-check"></i>
              Reservar Mesa
            </a>

            @if (isAdmin || isRestaurant) {
            <a class="action-btn edit-btn" [routerLink]="['/menus', restaurant?.id, 'create']">
              <i class="bi bi-plus-circle"></i>
              Crear Menú
            </a>
            <a class="action-btn secondary-btn" [routerLink]="['/restaurant', restaurant?.id, 'update']">
              <i class="bi bi-pencil-square"></i>
              Editar
            </a>
            }
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Sección de Promociones Activas -->
@if (activePromotions.length > 0) {
<section class="promotions-section">
  <div class="container">
    <div class="promotions-header">
      <h2 class="promotions-title">
        <i class="bi bi-tag-fill"></i>
        Promociones Activas
      </h2>
    </div>

    <div class="promotions-grid">
      @for (promo of activePromotions; track promo.id) {
      <div class="promo-card" [style.border-left-color]="getPromotionColor(promo.type)">
        <div class="promo-card-header">
          <div class="promo-icon" [style.background-color]="getPromotionColor(promo.type)">
            <i [class]="getPromotionIcon(promo.type)"></i>
          </div>
          <div class="promo-title-section">
            <h3 class="promo-title">{{ promo.title }}</h3>
            <span class="promo-value">{{ formatPromotionValue(promo) }}</span>
          </div>
        </div>
        
        <p class="promo-description">{{ promo.description }}</p>
        
        <div class="promo-footer">
          <div class="promo-validity">
            <i class="bi bi-calendar-range"></i>
            <span>Válido hasta {{ promo.endDate | date:'dd/MM/yyyy' }}</span>
          </div>
          @if (promo.maxUses && promo.currentUses !== undefined) {
          <div class="promo-usage">
            <i class="bi bi-people"></i>
            <span>{{ promo.currentUses }}/{{ promo.maxUses }} usos</span>
          </div>
          }
        </div>
        
        <!-- Botón para reservar con esta promoción -->
        <button class="promo-action-btn" 
                [routerLink]="['/bookings', restaurant?.id, 'reserve']"
                [queryParams]="{promotionId: promo.id}">
          <i class="bi bi-calendar-check-fill me-1"></i>
          Reservar con esta promo
        </button>
      </div>
      }
    </div>
  </div>
</section>
}

<!-- Sección de Menús estilo Social Media -->
<section class="menus-section">
  <div class="container">
    <!-- Header de sección -->
    <div class="menus-section-header">
      <h2 class="menus-main-title">
        <i class="bi bi-book-fill"></i>
        Nuestra Carta
      </h2>
    </div>

    <!-- Grid de menús tipo Instagram -->
    <div class="menus-grid">
      @for (menu of menus; track menu; let i = $index) {
      <article class="menu-card" [routerLink]="['/menus', menu?.id, 'detail']">
        <div class="menu-card-image">
          <img [src]="menu.imgMenu.startsWith('http') ? menu.imgMenu : ('https://api.fudi.es/files/' + menu.imgMenu)"
            [alt]="menu.title">
          
          <!-- Overlay con gradiente -->
          <div class="menu-card-overlay">
            <div class="menu-card-actions">
              <button class="menu-action-btn like-btn" title="Me gusta" (click)="$event.stopPropagation()">
                <i class="bi bi-heart"></i>
              </button>
            </div>
          </div>

          <!-- Tag de nuevo si es reciente -->
          @if (i < 2) {
          <div class="menu-new-badge">
            <i class="bi bi-stars"></i>
            <span>Destacado</span>
          </div>
          }
        </div>

        <div class="menu-card-content">
          <h3 class="menu-card-title">{{menu?.title}}</h3>
          <p class="menu-card-description">{{menu?.description}}</p>
          
          <div class="menu-card-footer">
            <div class="menu-stats">
              <span class="menu-stat">
                <i class="bi bi-eye-fill"></i>
                Ver carta
              </span>
            </div>
          </div>
        </div>
      </article>
      }

      @if (menus.length === 0) {
      <div class="empty-menus-state">
        <i class="bi bi-journal-x"></i>
        <p>No hay menús disponibles en este restaurante</p>
      </div>
      }
    </div>
  </div>
</section>

<!-- Sección de Recomendaciones estilo Social Media -->
<section class="recommendations-section">
  <div class="container">
    <!-- Header de sección -->
    <div class="recommendations-header">
      <h2 class="recommendations-title">
        <i class="bi bi-compass"></i>
        Más Restaurantes
      </h2>
    </div>

    <!-- Grid de restaurantes -->
    <div class="restaurants-grid">
      @for (restaurant of recommendedRestaurants; track restaurant) {
      <article class="restaurant-card" [routerLink]="['/restaurant', restaurant.id, 'detail']">
        <div class="restaurant-card-image">
          <img [src]="restaurant.imageUrl.startsWith('http') ? restaurant.imageUrl : 'https://api.fudi.es/files/' + restaurant.imageUrl"
            [alt]="restaurant.name">
          
          <!-- Overlay -->
          <div class="restaurant-card-overlay">
            <div class="restaurant-card-actions">
              <button class="restaurant-action-btn like-btn" title="Me gusta" (click)="$event.stopPropagation()">
                <i class="bi bi-heart"></i>
              </button>
            </div>
          </div>

          <!-- Rating badge -->
          <div class="restaurant-rating-badge">
            <i class="bi bi-star-fill"></i>
            <span>{{restaurant.averageRating || 0}}</span>
          </div>
        </div>

        <div class="restaurant-card-content">
          <h3 class="restaurant-card-title">{{restaurant.name}}</h3>
          <p class="restaurant-card-description">{{restaurant.description}}</p>
          
          <div class="restaurant-card-footer">
            <span class="restaurant-type-badge">{{getRestaurantType(restaurant.restaurantType)}}</span>
          </div>
        </div>
      </article>
      }
    </div>
  </div>
</section>

<!-- Sección de Reservas (solo para dueños del restaurante) -->
@if (canEdit) {
<section class="bookings-section">
  <div class="container">
    <!-- Header de sección -->
    <div class="bookings-header">
      <div class="section-tag">
        <i class="bi bi-calendar-event"></i>
        <span>Panel de Gestión</span>
      </div>
      <h2 class="bookings-title">Mis Reservas Activas</h2>
    </div>

    @if (bookings && bookings.length > 0) {
    <div class="bookings-list">
      @for (booking of bookings; track booking.id) {
      <div class="booking-card">
        <div class="card card-cover overflow-hidden text-bg-dark rounded-4 shadow-lg">
          @if(booking.restaurant?.imageUrl?.startsWith('http')) {
          <div class="background-image" [style.background-image]="'url(' + booking.restaurant?.imageUrl + ')'"></div>
          } @else {
          <div class="background-image" [style.background-image]="'url(https://api.fudi.es/files/' + (booking.restaurant?.imageUrl || '') + ')'"></div>
          }
          <div class="container-fluid custom">
            <div class="row mt-3 ms-2">
              <div class="col-md-4">
                <a [routerLink]="['/user', booking.user?.id, 'detail']"
                  style="cursor: pointer; color:white; text-decoration: none;">
                  <h3>{{booking.user?.firstName || 'Cliente'}} {{booking.user?.lastName || ''}}</h3>
                </a>
                <h6>Fecha de reserva:</h6>
                <p>{{booking.bookingDate || (booking.createDate | date: 'dd/MM/yy')}}</p>
              </div>
              <div class="col-md-4">
                <h6>Confirmado:</h6>
                @if (booking?.status) {
                <span class="badge text-bg-success">Sí</span>
                } @else {
                <span class="badge text-bg-danger">No</span>
                }
                <h6 class="mt-2">Cantidad de comensales:</h6>
                <p>{{booking?.numUsers}}</p>
              </div>
              <div class="col-md-4">
                <h6>Restaurant:</h6>
                <a class="badge text-bg-warning text-decoration-none"
                  [routerLink]="['/restaurants', booking?.restaurant?.id, 'detail']">
                  {{booking?.restaurant?.name}}
                </a>
              </div>
            </div>
            <div class="buttons mt-3 ms-2">
              <button class="btn btn-outline-light" [routerLink]="['/bookings', booking.id, 'detail']">
                <i class="bi bi-eye me-1"></i> Ver Reserva
              </button>
              @if (isAdmin || isRestaurant) {
              <button class="btn btn-outline-success" [routerLink]="['/bookings', booking?.id, 'update']">
                <i class="bi bi-pencil me-1"></i> Editar
              </button>
              <button class="btn btn-outline-danger">
                <i class="bi bi-trash me-1"></i> Borrar
              </button>
              }
            </div>
          </div>
        </div>
      </div>
      }
    </div>
    } @else {
    <div class="empty-bookings-state">
      <i class="bi bi-calendar-x"></i>
      <p>No hay reservas activas en este momento</p>
    </div>
    }
  </div>
</section>
}
}